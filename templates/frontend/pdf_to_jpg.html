{% extends "frontend/converter_generic.html" %}
{% load i18n static %}

{% block edit_options %}
  <div class="bg-gray-50 rounded-xl p-5 sm:p-6 border border-gray-200 mb-6">
    <h3 class="text-lg font-bold mb-4 text-gray-900">{% trans "Page Selection" %}</h3>

    <div class="space-y-4">
        <!-- Pages to Convert -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-3">
          {% trans "Pages to Convert" %}
        </label>
        <div class="space-y-3">
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio"
                   name="pagesOption"
                   id="convertPagesAll"
                   value="all"
                   checked
                   class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-sm text-gray-700">{% trans "All pages" %}</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio"
                   name="pagesOption"
                   id="convertPagesCustom"
                   value="custom"
                   class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-sm text-gray-700">{% trans "Custom pages:" %}</span>
          </label>
          <input type="text"
                 id="convertPagesCustomInput"
                 name="pagesCustom"
                 placeholder="1,3,5 or 1-5"
                 disabled
                 class="ml-6 w-full sm:w-auto min-w-[200px] px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed"
                 pattern="^[\d,\- ]+$">
          <p class="ml-6 text-xs text-gray-500">
            {% trans "Enter specific pages like '1,3,5' or '1-5'" %}
          </p>
        </div>
        <input type="hidden" id="pages" name="pages" value="all">
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script src="{% static 'js/pages-selector.js' %}"></script>
  <script>
    // Override pages selector prefix for PDF to JPG
    document.addEventListener('DOMContentLoaded', () => {
      const allRadio = document.getElementById('convertPagesAll');
      const customRadio = document.getElementById('convertPagesCustom');
      const customInput = document.getElementById('convertPagesCustomInput');
      const hiddenPagesInput = document.getElementById('pages');

      if (allRadio && customRadio && customInput && hiddenPagesInput) {
        allRadio.addEventListener('change', () => {
          customInput.disabled = true;
          customInput.value = '';
          customInput.removeAttribute('required');
          hiddenPagesInput.value = 'all';
        });

        customRadio.addEventListener('change', () => {
          customInput.disabled = false;
          customInput.setAttribute('required', 'required');
          if (customInput.value.trim()) {
            hiddenPagesInput.value = customInput.value.trim();
          }
        });

        customInput.addEventListener('input', () => {
          if (customRadio.checked && customInput.value.trim()) {
            hiddenPagesInput.value = customInput.value.trim();
          }
        });
      }

      // Override form submission to include pages parameter
      const form = document.getElementById('converterForm');
      if (form) {
        form.addEventListener('submit', (e) => {
          const pagesValue = hiddenPagesInput ? hiddenPagesInput.value : 'all';
          // The pages value will be sent via FormData in converter.js
          // We just need to ensure it's available
          if (!form.querySelector('input[name="pages"]')) {
            const pagesInput = document.createElement('input');
            pagesInput.type = 'hidden';
            pagesInput.name = 'pages';
            pagesInput.value = pagesValue;
            form.appendChild(pagesInput);
          } else {
            form.querySelector('input[name="pages"]').value = pagesValue;
          }
        });
      }
    });
  </script>
{% endblock %}
