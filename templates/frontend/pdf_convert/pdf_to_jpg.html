{% extends "frontend/converter_generic.html" %}
{% load i18n static %}

{% block edit_options %}
  <div class="bg-gray-50 rounded-xl p-5 sm:p-6 border border-gray-200 mb-6">
    <h3 class="text-lg font-bold mb-4 text-gray-900">{% trans "Page Selection" %}</h3>

    <div class="space-y-4">
        <!-- Pages to Convert -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-3">
          {% trans "Pages to Convert" %}
        </label>
        <div class="space-y-3">
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio"
                   name="pagesOption"
                   id="convertPagesAll"
                   value="all"
                   checked
                   class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-sm text-gray-700">{% trans "All pages" %}</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio"
                   name="pagesOption"
                   id="convertPagesCustom"
                   value="custom"
                   class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-sm text-gray-700">{% trans "Custom pages:" %}</span>
          </label>
          <input type="text"
                 id="convertPagesCustomInput"
                 name="pagesCustom"
                 placeholder="1,3,5 or 1-5"
                 disabled
                 class="ml-6 w-full sm:w-auto min-w-[200px] px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed"
                 pattern="^[\d,\- ]+$">
          <p class="ml-6 text-xs text-gray-500">
            {% trans "Enter specific pages like '1,3,5' or '1-5'" %}
          </p>
        </div>
        <input type="hidden" id="pages" name="pages" value="all">
      </div>

      <!-- DPI Selection -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-3" for="dpiSelect">
          {% trans "Image Quality (DPI)" %}
        </label>
        <select id="dpiSelect"
                name="dpi"
                class="w-full sm:w-auto min-w-[200px] px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900">
          <option value="150">150 DPI - {% trans "Smaller file size" %}</option>
          <option value="200">200 DPI - {% trans "Balanced" %}</option>
          <option value="300" selected>300 DPI - {% trans "High quality (recommended)" %}</option>
          <option value="400">400 DPI - {% trans "Very high quality" %}</option>
          <option value="600">600 DPI - {% trans "Maximum quality" %}</option>
        </select>
        <p class="mt-2 text-xs text-gray-500">
          {% trans "Higher DPI = better quality but larger file size. 300 DPI is recommended for most uses." %}
        </p>
      </div>
    </div>
  </div>
{% endblock %}

{% block help_section %}
  <div class="mt-8 sm:mt-10 bg-gradient-to-br from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-5 sm:p-7" style="font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
    <h2 class="text-lg sm:text-xl font-bold mb-4 text-gray-900" style="font-family: 'Poppins', sans-serif; font-weight: 700; letter-spacing: -0.02em;">
      {% trans "How it works" %}
    </h2>
    <ol class="list-decimal list-inside space-y-2.5 text-sm sm:text-base text-gray-700" style="font-family: 'Inter', sans-serif; font-weight: 500; line-height: 1.7;">
      <li>{% trans "Select your PDF file using the button above or drag and drop it into the zone below" %}</li>
      <li>{% trans "Choose which pages to convert from PDF to JPG: all pages or specific pages (e.g., 1,3,5 or 1-5)" %}</li>
      <li>{% trans "Select DPI quality for PDF to JPG conversion (300 DPI recommended for high quality, 72 DPI for smaller file size)" %}</li>
      <li>{% trans "Click the convert button to start the PDF to JPG conversion process" %}</li>
      <li>{% trans "Wait for the PDF to JPG conversion to complete - all selected pages will be converted to JPG images" %}</li>
      <li>{% trans "Download the ZIP archive containing all converted JPG images from your PDF" %}</li>
    </ol>
    <div class="mt-4 pt-4 border-t border-blue-200">
      <p class="text-xs sm:text-sm text-gray-600">
        <strong>{% trans "Note:" %}</strong> {% blocktrans with max_pages=conversion_limits.max_free_pdf_pages %}Free users can convert PDF files with up to {{ max_pages }} pages. Premium users have higher limits. For larger files, please split them into smaller parts. The output will be a ZIP archive containing all converted JPG images, named with page numbers (e.g., filename_page0001.jpg, filename_page0002.jpg).{% endblocktrans %}
      </p>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script src="{% static 'js/pages-selector.js' %}" nonce="{{ csp_nonce }}"></script>
  <script nonce="{{ csp_nonce }}">
    // Override pages selector prefix for PDF to JPG
    document.addEventListener('DOMContentLoaded', () => {
      const allRadio = document.getElementById('convertPagesAll');
      const customRadio = document.getElementById('convertPagesCustom');
      const customInput = document.getElementById('convertPagesCustomInput');
      const hiddenPagesInput = document.getElementById('pages');

      if (allRadio && customRadio && customInput && hiddenPagesInput) {
        allRadio.addEventListener('change', () => {
          customInput.disabled = true;
          customInput.value = '';
          customInput.removeAttribute('required');
          hiddenPagesInput.value = 'all';
        });

        customRadio.addEventListener('change', () => {
          customInput.disabled = false;
          customInput.setAttribute('required', 'required');
          if (customInput.value.trim()) {
            hiddenPagesInput.value = customInput.value.trim();
          }
        });

        customInput.addEventListener('input', () => {
          if (customRadio.checked && customInput.value.trim()) {
            hiddenPagesInput.value = customInput.value.trim();
          }
        });
      }

      // Override form submission to include pages and dpi parameters
      const form = document.getElementById('converterForm');
      if (form) {
        form.addEventListener('submit', (e) => {
          const pagesValue = hiddenPagesInput ? hiddenPagesInput.value : 'all';
          // The pages value will be sent via FormData in converter.js
          // We just need to ensure it's available
          if (!form.querySelector('input[name="pages"]')) {
            const pagesInput = document.createElement('input');
            pagesInput.type = 'hidden';
            pagesInput.name = 'pages';
            pagesInput.value = pagesValue;
            form.appendChild(pagesInput);
          } else {
            form.querySelector('input[name="pages"]').value = pagesValue;
          }
          // DPI is already in the form as a select element, converter.js will handle it
        });
      }
    });
  </script>
{% endblock %}
