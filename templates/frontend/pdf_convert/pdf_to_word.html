{% extends "frontend/converter_generic.html" %}
{% load i18n static %}

{% block scripts %}
  <script src="{% static 'js/utils.js' %}"></script>
  <script src="{% static 'js/task-cancellation.js' %}"></script>
  <script src="{% static 'js/file-input-handler.js' %}"></script>
  <script src="{% static 'js/pdf-to-word.js' %}"></script>
  <script src="{% static 'js/converter.js' %}"></script>
{% endblock %}

{% block edit_options %}
  {% if PAYMENTS_ENABLED %}
    <!-- OCR Options for Premium Users -->
    <div class="mb-6 p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border border-amber-200 dark:border-amber-800/60 rounded-lg" data-premium="{% if user.is_authenticated and user.is_premium_active %}true{% else %}false{% endif %}">
      <!-- OCR Toggle (Premium Feature) -->
      <div class="flex items-start space-x-3 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl">
        <input type="checkbox"
               id="ocrEnabled"
               name="ocrEnabled"
               value="true"
               class="mt-1 w-4 h-4 text-amber-600 border-gray-300 dark:border-gray-600 rounded focus:ring-amber-500 disabled:opacity-50 disabled:cursor-not-allowed"
               {% if not user.is_authenticated or not user.is_premium_active %}disabled{% endif %}>
        <div class="flex-1">
          <label for="ocrEnabled" class="text-sm font-medium text-gray-900 dark:text-gray-100 cursor-pointer {% if not user.is_authenticated or not user.is_premium_active %}cursor-not-allowed opacity-60{% endif %}">
            {% trans "Enable OCR (Optical Character Recognition)" %}
          </label>
          <p class="text-xs text-gray-600 dark:text-gray-300 mt-1">
            {% if user.is_authenticated and user.is_premium_active %}
              {% trans "Extract text from scanned PDFs and images. Convert image-based PDFs to editable text." %}
            {% else %}
              {% trans "Premium feature - extract text from scanned PDFs and images. Upgrade to Premium to enable." %}
            {% endif %}
          </p>
          {% if not user.is_authenticated %}
            <a href="{% url 'users:login' %}" class="text-xs text-amber-700 dark:text-amber-300 hover:text-amber-800 dark:hover:text-amber-200 font-medium mt-1 inline-block">
              {% trans "Log in to upgrade" %} &rarr;
            </a>
          {% elif not user.is_premium_active %}
            <a href="{% if user.is_authenticated %}{% url 'frontend:pricing' %}{% else %}{% url 'users:login' %}?next={% url 'frontend:pricing' %}{% endif %}" class="text-xs text-amber-700 dark:text-amber-300 hover:text-amber-800 dark:hover:text-amber-200 font-medium mt-1 inline-block">
              {% trans "Upgrade to Premium" %} &rarr;
            </a>
          {% endif %}
        </div>
      </div>

        <!-- OCR Language Selection (visible only for premium users) -->
        <!-- Debug: user.is_authenticated={{ user.is_authenticated }}, user.is_premium={{ user.is_premium }} -->
      {% if user.is_authenticated and user.is_premium_active %}
        <div id="ocrLanguageSection" class="pl-7 space-y-2">
          <label for="ocrLanguage" class="text-sm font-medium text-gray-900 dark:text-gray-100">
            {% trans "Document Language" %}
          </label>
          <select id="ocrLanguage"
                  name="ocr_language"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"
                  {% if not user.is_authenticated or not user.is_premium_active %}disabled{% endif %}>
            <option value="auto">{% trans "Auto-detect" %}</option>
            <option value="eng">{% trans "English" %}</option>
            <option value="rus">{% trans "Russian" %}</option>
            <option value="deu">{% trans "German" %}</option>
            <option value="fra">{% trans "French" %}</option>
            <option value="spa">{% trans "Spanish" %}</option>
            <option value="ita">{% trans "Italian" %}</option>
            <option value="por">{% trans "Portuguese" %}</option>
            <option value="pol">{% trans "Polish" %}</option>
            <option value="ukr">{% trans "Ukrainian" %}</option>
            <option value="chi_sim">{% trans "Chinese (Simplified)" %}</option>
            <option value="chi_tra">{% trans "Chinese (Traditional)" %}</option>
            <option value="jpn">{% trans "Japanese" %}</option>
            <option value="kor">{% trans "Korean" %}</option>
            <option value="ara">{% trans "Arabic" %}</option>
            <option value="hin">{% trans "Hindi" %}</option>
            <option value="tur">{% trans "Turkish" %}</option>
            <option value="ind">{% trans "Indonesian" %}</option>
          </select>
          <p class="text-xs text-gray-500 dark:text-gray-400">
            {% trans "Select the language of your document for better OCR accuracy." %}
          </p>
        </div>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}

{% block help_section %}
  <div class="mt-8 sm:mt-10 bg-gradient-to-br from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-5 sm:p-7" style="font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
    <h2 class="text-lg sm:text-xl font-bold mb-4 text-gray-900" style="font-family: 'Poppins', sans-serif; font-weight: 700; letter-spacing: -0.02em;">
      {% trans "How it works" %}
    </h2>
    <ol class="list-decimal list-inside space-y-2.5 text-sm sm:text-base text-gray-700" style="font-family: 'Inter', sans-serif; font-weight: 500; line-height: 1.7;">
      <li>{% trans "Select your PDF file using the button above or drag and drop it into the zone below" %}</li>
      <li>{% trans "Click the convert button to start converting PDF to Word (PDF to DOCX conversion)" %}</li>
      <li>{% trans "Wait for the PDF to Word conversion to complete - text and formatting will be extracted from your PDF and converted to editable Word format" %}</li>
      <li>{% trans "Download your editable Word document (DOCX format) - your PDF has been successfully converted to Word" %}</li>
    </ol>
    <div class="mt-4 pt-4 border-t border-blue-200">
      <p class="text-xs sm:text-sm text-gray-600" id="pageLimitNote">
        <strong>{% trans "Note:" %}</strong>
        <span id="freeUserNote">
          {% if PAYMENTS_ENABLED %}
            {% blocktrans with max_pages=conversion_limits.max_free_pdf_pages %}
              PDF files with up to {{ max_pages }} pages are supported for free users. For larger files, please split them into smaller parts or upgrade to Premium to process larger files with higher limits.
            {% endblocktrans %}
          {% else %}
            {% blocktrans with max_pages=conversion_limits.max_free_pdf_pages %}
              PDF files with up to {{ max_pages }} pages are supported. For larger files, please split them into smaller parts.
            {% endblocktrans %}
          {% endif %}
        </span>
        <span id="premiumUserNote" class="hidden">
          {% blocktrans with max_pages=conversion_limits.max_premium_pdf_pages %}
            Premium users can process PDF files with up to {{ max_pages }} pages. For larger files, please split them into smaller parts.
          {% endblocktrans %}
        </span>
        {% if PAYMENTS_ENABLED %}
          {% trans "Text-based PDFs work best - scanned PDFs (image-only) can be converted with OCR for Premium users." %}
        {% else %}
          {% trans "Text-based PDFs work best." %}
        {% endif %}
      </p>
    </div>
  </div>
{% endblock %}
