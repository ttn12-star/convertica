{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "PDF to Word - Convertica" %}{% endblock %}
{% block description %}{% trans "Upload PDF files and download Word documents instantly." %}{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">{% trans "PDF â†’ Word Converter" %}</h1>

<form id="pdfToWordForm" method="post" enctype="multipart/form-data" class="bg-white p-6 rounded shadow">
    {% csrf_token %}
    <input type="file" name="pdf_file" id="pdfFile" accept=".pdf" class="border p-2 mb-4 w-full">
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">{% trans "Convert" %}</button>
</form>

<div id="pdfToWordResult" class="mt-4"></div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('pdfToWordForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const fileInput = document.getElementById('pdfFile');
    if (!fileInput.files.length) return alert("{% trans 'Please select a PDF file.' %}");
    
    const formData = new FormData();
    formData.append('pdf_file', fileInput.files[0]);

    const response = await fetch("{% url 'pdf_to_word_api' %}", {
        method: 'POST',
        body: formData,
        headers: { 'X-CSRFToken': '{{ csrf_token }}' }
    });

    if (response.ok) {
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileInput.files[0].name.replace(/\.pdf$/, '.docx');
        document.body.appendChild(a);
        a.click();
        a.remove();
    } else {
        const data = await response.json();
        alert(data.error || "{% trans 'Conversion failed.' %}");
    }
});
</script>
{% endblock %}
