{% extends "frontend/edit_pdf_generic.html" %}
{% load i18n static %}

{% block extra_head %}
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" as="script" crossorigin>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" defer></script>
  <link rel="stylesheet" href="{% static 'css/pdf-preview.css' %}">
{% endblock %}

{% block edit_options %}
  <div class="bg-gray-50 rounded-xl p-5 sm:p-6 border border-gray-200 mb-6">
    <h3 class="text-lg font-bold mb-4 text-gray-900">{% trans "Organization Settings" %}</h3>

    <div class="space-y-4">
      <div>
        <label for="operation" class="block text-sm font-semibold text-gray-700 mb-2">
          {% trans "Operation" %}
        </label>
        <select id="operation" name="operation"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900">
          <option value="reorder">{% trans "Reorder Pages" %}</option>
          <option value="sort">{% trans "Sort Pages" %}</option>
        </select>
      </div>
    </div>
  </div>

<!-- PDF Preview Section -->
  <div id="pdfPreviewSection" class="hidden bg-gray-50 rounded-xl p-5 sm:p-6 border border-gray-200 mb-6">
    <h3 class="text-lg font-bold mb-4 text-gray-900">{% trans "Reorder Pages" %}</h3>
    <p class="text-sm text-gray-600 mb-4">
      {% trans "Drag and drop pages to reorder them. The number on each page shows the new order." %}
    </p>
    <div id="pdfPreviewContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        <!-- PDF page thumbnails will be added here -->
    </div>
    <!-- Error message container -->
    <div id="errorMessage" class="hidden mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm"></div>
  </div>

  <script>
    window.API_URL = "{{ api_url|escapejs }}";
    // Organize PDF translations
    window.PAGE_LABEL = "{% filter escapejs %}{% trans 'Page' %}{% endfilter %}";
    window.SELECT_PDF_FILE = "{% filter escapejs %}{% trans 'Please select a PDF file.' %}{% endfilter %}";
    window.SELECT_PDF_FIRST = "{% filter escapejs %}{% trans 'Please select a PDF file first.' %}{% endfilter %}";
    window.FAILED_TO_LOAD_PDF = "{% filter escapejs %}{% trans 'Failed to load PDF file. Please try again.' %}{% endfilter %}";
    window.ORGANIZING = "{% filter escapejs %}{% trans 'Organizing...' %}{% endfilter %}";
    window.FAILED_TO_ORGANIZE = "{% filter escapejs %}{% trans 'Failed to organize PDF' %}{% endfilter %}";
    window.PAGE_LIMIT_ERROR = "{% filter escapejs %}{% trans 'PDF has %(page_count)d pages, maximum allowed is %(max_pages)d. Please split your PDF into smaller parts.' %}{% endfilter %}";
    window.PATIENCE_TITLE = "{% filter escapejs %}{% trans 'Everything is going well!' %}{% endfilter %}";
    window.PATIENCE_MESSAGE = "{% filter escapejs %}{% trans 'Large files take a bit longer. Please do not close this page â€” your file is being processed.' %}{% endfilter %}";
  </script>
  <script src="{% static 'js/utils.js' %}"></script>
  <script src="{% static 'js/task-cancellation.js' %}"></script>
  <script src="{% static 'js/file-input-handler.js' %}"></script>
  <script src="{% static 'js/organize-pdf.js' %}"></script>
{% endblock %}

{% block help_section %}
  <div class="mt-8 sm:mt-10 bg-gradient-to-br from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-5 sm:p-7" style="font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
    <h2 class="text-lg sm:text-xl font-bold mb-4 text-gray-900" style="font-family: 'Poppins', sans-serif; font-weight: 700; letter-spacing: -0.02em;">
      {% trans "How it works" %}
    </h2>
    <ol class="list-decimal list-inside space-y-2.5 text-sm sm:text-base text-gray-700" style="font-family: 'Inter', sans-serif; font-weight: 500; line-height: 1.7;">
      <li>{% trans "Select your PDF file using the button above or drag and drop it into the zone below" %}</li>
      <li>{% trans "Preview all pages and drag them to reorder pages in your PDF document" %}</li>
      <li>{% trans "Choose operation: reorder pages manually or sort pages automatically" %}</li>
      <li>{% trans "Click the organize button to process your PDF and reorganize the pages" %}</li>
      <li>{% trans "Download your reorganized PDF file with pages in the new order using the download button" %}</li>
    </ol>
    <div class="mt-4 pt-4 border-t border-blue-200">
      <p class="text-xs sm:text-sm text-gray-600">
        <strong>{% trans "Note:" %}</strong> {% trans "PDF files with up to 50 pages are supported for organizing. For larger files, please split them into smaller parts. You can drag and drop pages to reorder them visually." %}
      </p>
    </div>
  </div>
{% endblock %}
