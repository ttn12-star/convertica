{% extends "frontend/edit_pdf_generic.html" %}
{% load i18n %}

{% block edit_options %}
  <div class="bg-gray-50 rounded-xl p-5 sm:p-6 border border-gray-200">
    <h3 class="text-lg font-bold mb-4 text-gray-900">{% trans "Page Number Settings" %}</h3>

    <div class="space-y-4">
        <!-- Position -->
      <div>
        <label for="position" class="block text-sm font-semibold text-gray-700 mb-2">
          {% trans "Position" %}
        </label>
        <select id="position" name="position"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900">
          <option value="bottom-center">{% trans "Bottom Center" %}</option>
          <option value="bottom-left">{% trans "Bottom Left" %}</option>
          <option value="bottom-right">{% trans "Bottom Right" %}</option>
          <option value="top-center">{% trans "Top Center" %}</option>
          <option value="top-left">{% trans "Top Left" %}</option>
          <option value="top-right">{% trans "Top Right" %}</option>
        </select>
      </div>

        <!-- Font Size -->
      <div>
        <label for="font_size" class="block text-sm font-semibold text-gray-700 mb-2">
          {% trans "Font Size" %} (8-72)
        </label>
        <input type="number"
               id="font_size"
               name="font_size"
               value="12"
               min="8"
               max="72"
               class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900">
      </div>

        <!-- Start Number -->
      <div>
        <label for="start_number" class="block text-sm font-semibold text-gray-700 mb-2">
          {% trans "Starting Page Number" %}
        </label>
        <input type="number"
               id="start_number"
               name="start_number"
               value="1"
               min="1"
               class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900">
      </div>

        <!-- Format -->
      <div>
        <label for="format_str" class="block text-sm font-semibold text-gray-700 mb-2">
          {% trans "Format" %}
        </label>
        <input type="text"
               id="format_str"
               name="format_str"
               value="{page}"
               placeholder="{page} or {page} of {total}"
               class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900">
        <p class="mt-1.5 text-xs text-gray-500">
          {% trans "Use {page} for page number, {total} for total pages" %}
        </p>
      </div>

        <!-- Pages to Add Numbers -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-3">
          {% trans "Apply to pages" %}
        </label>
        <div class="space-y-3">
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio"
                   name="pagesOption"
                   id="pageNumbersPagesAll"
                   value="all"
                   checked
                   class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-sm text-gray-700">{% trans "All pages" %}</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio"
                   name="pagesOption"
                   id="pageNumbersPagesCurrent"
                   value="current"
                   class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-sm text-gray-700">{% trans "Current page only" %}</span>
          </label>
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio"
                   name="pagesOption"
                   id="pageNumbersPagesCustom"
                   value="custom"
                   class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-sm text-gray-700">{% trans "Custom pages:" %}</span>
          </label>
          <input type="text"
                 id="pageNumbersPagesCustomInput"
                 name="pagesCustom"
                 placeholder="1,3,5 or 1-5"
                 disabled
                 class="ml-6 w-full sm:w-auto min-w-[200px] px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed"
                 pattern="^[\d,\- ]+$">
          <p class="ml-6 text-xs text-gray-500">
            {% trans "Enter specific pages like '1,3,5' or '1-5'" %}
          </p>
        </div>
        <input type="hidden" id="pages" name="pages" value="all">
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_head %}
  {{ block.super }}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" defer></script>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script src="{% static 'js/page-number-preview.js' %}"></script>
{% endblock %}

{% block after_edit_options %}
  <!-- Preview Section -->
  <div id="pageNumberPreviewSection" class="hidden mt-6">
    <div class="bg-gray-50 rounded-xl p-5 sm:p-6 border border-gray-200">
      <div class="flex items-center justify-between gap-4 mb-4">
        <h3 class="text-lg font-bold text-gray-900">{% trans "Preview" %}</h3>
        <div class="flex items-center gap-2">
          <label for="pageNumberPageSelector" class="text-sm font-semibold text-gray-700">
            {% trans "Select page" %}
          </label>
          <select id="pageNumberPageSelector"
                  class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 text-sm">
          </select>
        </div>
      </div>

      <div class="relative bg-white border-2 border-gray-300 rounded-lg p-4 overflow-hidden flex justify-center items-center" style="max-height: 85vh; min-height: 400px;">
        <div id="pageNumberCanvasContainer" class="relative inline-block" style="max-width: 100%; max-height: 100%;">
          <canvas id="pageNumberCanvas" class="border border-gray-200 shadow-lg" style="max-width: 100%; max-height: 100%; display: block;"></canvas>
        </div>
      </div>

      <p class="mt-3 text-xs text-gray-600">
        {% trans "Preview shows page numbers as they will appear in the final PDF after download." %}
      </p>
    </div>
  </div>
{% endblock %}

{% block help_section %}
  <div class="mt-8 sm:mt-10 bg-gradient-to-br from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-5 sm:p-7" style="font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
    <h2 class="text-lg sm:text-xl font-bold mb-4 text-gray-900" style="font-family: 'Poppins', sans-serif; font-weight: 700; letter-spacing: -0.02em;">
      {% trans "How it works" %}
    </h2>
    <ol class="list-decimal list-inside space-y-2.5 text-sm sm:text-base text-gray-700" style="font-family: 'Inter', sans-serif; font-weight: 500; line-height: 1.7;">
      <li>{% trans "Select your PDF file using the button above or drag and drop it into the zone below" %}</li>
      <li>{% trans "Choose the position, font size, starting number, and format for adding page numbers to PDF" %}</li>
      <li>{% trans "Preview how the page numbers will look on your PDF using the live preview" %}</li>
      <li>{% trans "Select which pages to add numbers to: all pages, current page only, or specific pages" %}</li>
      <li>{% trans "Click the add page numbers button to process your PDF and add page numbers" %}</li>
      <li>{% trans "Download your PDF file with page numbers added using the download button" %}</li>
    </ol>
    <div class="mt-4 pt-4 border-t border-blue-200">
      <p class="text-xs sm:text-sm text-gray-600">
        <strong>{% trans "Note:" %}</strong> {% trans "PDF files with up to 50 pages are supported for adding page numbers. For larger files, please split them into smaller parts. The page numbers will be added according to your selected position, format, and font size." %}
      </p>
      <p class="text-xs sm:text-sm text-gray-600 mt-2">
        {% trans "Perfect for: adding page numbers to PDF documents, numbering PDF pages, inserting page numbers in PDF files, adding page numbers to PDF reports, numbering pages in PDF documents, inserting page numbers in PDF contracts, adding page numbers to PDF invoices, numbering pages in PDF legal documents, inserting page numbers in PDF academic papers, adding page numbers to PDF business documents, numbering pages in PDF presentations, inserting page numbers in PDF manuals, adding page numbers to PDF books, numbering pages in PDF catalogs, inserting page numbers in PDF portfolios." %}
      </p>
    </div>
  </div>
{% endblock %}
