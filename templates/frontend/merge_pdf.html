{% extends "frontend/edit_pdf_generic.html" %}
{% load i18n static %}

{% block extra_head %}
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" as="script" crossorigin>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" defer></script>
  <link rel="stylesheet" href="{% static 'css/pdf-preview.css' %}">
{% endblock %}

{% block edit_options %}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Enable multiple file selection for merge
      const fileInput = document.getElementById('fileInput');
      const fileInputDrop = document.getElementById('fileInputDrop');
      const selectFileButton = document.getElementById('selectFileButton');

      if (fileInput) {
        fileInput.setAttribute('multiple', 'multiple');
        fileInput.removeAttribute('required');
      }
      if (fileInputDrop) {
        fileInputDrop.setAttribute('multiple', 'multiple');
        fileInputDrop.removeAttribute('required');
      }
      // Update button text for multiple file selection
      if (selectFileButton) {
        const buttonText = selectFileButton.querySelector('span');
        if (buttonText) {
          buttonText.textContent = "{% trans 'Select PDF files' %}";
        }
      }
    });
  </script>

  <div class="bg-gray-50 rounded-xl p-5 sm:p-6 border border-gray-200 mb-6">
    <h3 class="text-lg font-bold mb-4 text-gray-900">{% trans "Merge Settings" %}</h3>

    <div class="space-y-4">

        <!-- Selected Files List -->
      <div id="selectedPdfFilesContainer" class="hidden">
        <div class="bg-white rounded-lg border border-gray-200 p-4">
          <h4 class="text-sm font-semibold text-gray-900 mb-3">
            {% trans "Selected Files" %} (<span id="pdfFileCount">0</span>)
          </h4>
          <div id="selectedPdfFilesList" class="space-y-2 max-h-64 overflow-y-auto">
                    <!-- Files will be added here dynamically -->
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- PDF Preview Section -->
  <div id="pdfPreviewSection" class="hidden bg-gray-50 rounded-xl p-5 sm:p-6 border border-gray-200 mb-6">
    <h3 class="text-lg font-bold mb-4 text-gray-900">{% trans "Preview & Reorder Pages" %}</h3>
    <p class="text-sm text-gray-600 mb-4">
      {% trans "Drag and drop to reorder files. The order shown here will be the merge order." %}
    </p>
    <div id="pdfPreviewContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        <!-- PDF previews will be added here -->
    </div>
  </div>

  <script>
    // Merge PDF translations
    window.PAGE_LABEL = "{% trans 'Page' %}";
    window.FILE_NOT_PDF = "{% trans 'is not a PDF file. Skipping.' %}";
    window.MAX_FILES_EXCEEDED = "{% trans 'Maximum 10 files allowed. Only the first 10 files will be used.' %}";
    window.ERROR_LOADING_PREVIEW = "{% trans 'Error loading preview' %}";
    window.LOADING_PREVIEW = "{% trans 'Loading...' %}";
    window.FAILED_TO_LOAD_PDF = "{% trans 'Failed to load PDF file. Please try again.' %}";
    window.MERGING_PDFS = "{% trans 'Merging PDFs...' %}";
    window.SELECT_AT_LEAST_2_FILES = "{% trans 'Please select at least 2 PDF files to merge.' %}";
  </script>
  <script src="{% static 'js/merge-pdf-multi.js' %}"></script>
{% endblock %}

{% block help_section %}
  <div class="mt-8 sm:mt-10 bg-gradient-to-br from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-5 sm:p-7" style="font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
    <h2 class="text-lg sm:text-xl font-bold mb-4 text-gray-900" style="font-family: 'Poppins', sans-serif; font-weight: 700; letter-spacing: -0.02em;">
      {% trans "How it works" %}
    </h2>
    <ol class="list-decimal list-inside space-y-2.5 text-sm sm:text-base text-gray-700" style="font-family: 'Inter', sans-serif; font-weight: 500; line-height: 1.7;">
      <li>{% trans "Select 2-10 PDF files to merge using the button above" %}</li>
      <li>{% trans "Preview all PDF files and drag them to reorder the merge order" %}</li>
      <li>{% trans "Click the merge button to combine all PDF files into one document" %}</li>
      <li>{% trans "Download your merged PDF file containing all pages from all selected files using the download button" %}</li>
    </ol>
    <div class="mt-4 pt-4 border-t border-blue-200">
      <p class="text-xs sm:text-sm text-gray-600">
        <strong>{% trans "Note:" %}</strong> {% trans "You can merge 2-10 PDF files at once. The merged PDF will contain all pages from all selected files in the order you specified." %}
      </p>
      <p class="text-xs sm:text-sm text-gray-600 mt-2">
        {% trans "Perfect for: merging multiple PDF files into one, combining PDF documents, joining PDF files together, merging PDF files for sharing, combining PDF documents into single file, joining multiple PDF files, merging PDF files for printing, combining PDF reports into one document, joining PDF files for archiving, merging PDF files for presentations, combining PDF invoices into one file, joining PDF contracts into single document, merging PDF files for business, combining PDF academic papers, joining PDF files for legal documents." %}
      </p>
    </div>
  </div>
{% endblock %}
