{% load static i18n %}
<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
{% get_current_language_bidi as LANGUAGE_BIDI %}
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name='impact-site-verification' value='af3484b7-1cc3-421d-a5e9-40ae304c4315'>

    <!-- Primary Meta Tags -->
    <title>{% block title %}Convertica – Online PDF ↔ Word Converter{% endblock %}</title>
    <meta name="title" content="{% block meta_title %}{% endblock %}">
    <meta name="description" content="{% block description %}{% trans "Fast, simple and secure online PDF to Word and Word to PDF converter. No installations required." %}{% endblock %}">
    <meta name="keywords" content="{% block keywords %}{% trans "PDF to Word, Word to PDF, PDF converter, DOCX converter, online converter, free converter" %}{% endblock %}">
    <meta name="author" content="Convertica">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="language" content="{{ LANGUAGE_CODE }}">
    <meta name="revisit-after" content="7 days">
    <meta name="theme-color" content="#2563eb">
    <meta name="format-detection" content="telephone=no">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}">
    <meta property="og:title" content="{% block og_title %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'images/og-image.jpg' %}{% endblock %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{% block og_image_alt %}Convertica - Online PDF Tools{% endblock %}">
    <meta property="og:locale" content="{% if LANGUAGE_CODE == 'ru' %}ru_RU{% elif LANGUAGE_CODE == 'pl' %}pl_PL{% elif LANGUAGE_CODE == 'hi' %}hi_IN{% elif LANGUAGE_CODE == 'es' %}es_ES{% elif LANGUAGE_CODE == 'id' %}id_ID{% else %}en_US{% endif %}">
    <meta property="og:site_name" content="Convertica">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}">
    <meta property="twitter:title" content="{% block twitter_title %}{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'images/og-image.jpg' %}{% endblock %}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}">

    <!-- Preconnect to external domains -->
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://challenges.cloudflare.com">
    <link rel="preconnect" href="https://challenges.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://cloudflare-static.com">
    <link rel="preconnect" href="https://cloudflare-static.com" crossorigin>

    <!-- Google Fonts -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>

    <!-- Hreflang -->
    {% for link in hreflangs %}
      <link rel="alternate" hreflang="{{ link.code }}" href="{{ link.url }}">
    {% endfor %}

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon-16x16.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="48x48" href="{% static 'favicon-48x48.png' %}">
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="192x192" href="{% static 'favicon-192x192.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}">

    <!-- Stylesheets -->
    <link rel="preload" href="{% static 'css/tailwind.css' %}" as="style">
    <link rel="stylesheet" href="{% static 'css/tailwind.css' %}" media="all">

    <!-- Custom Animations -->
    <style>
      @keyframes progress { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      @keyframes scaleIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
      @keyframes ping {75%,100%{transform:scale(2);opacity:0;}}

      .animate-progress { animation: progress 2s linear infinite; background-size: 200% 100%; }
      .animate-fade-in { animation: fadeIn 0.5s ease-out; }
      .animate-scale-in { animation: scaleIn 0.3s ease-out; }
      .shadow-3xl { box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.25); }

      html, body { overflow-x: hidden; max-width: 100%; width: 100%; }
      * { box-sizing: border-box; transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter; transition-timing-function: cubic-bezier(0.4,0,0.2,1); transition-duration: 150ms; }

      body { color: #111827; }
      p, span, div, h1, h2, h3, h4, h5, h6, a, li, label, button, input, select, textarea { color: inherit; }

      img, video, iframe, embed, object { max-width: 100%; height: auto; }

      @media (max-width: 640px) { .absolute { max-width: calc(100vw - 1rem); } }
    </style>

    <!-- Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Convertica",
        "url": "{{ request.scheme }}://{{ request.get_host }}",
        "description": "{% trans "Fast, simple and secure online PDF to Word and Word to PDF converter." %}",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "inLanguage": "{{ LANGUAGE_CODE }}",
        "availableLanguage": [
          {% get_available_languages as LANGUAGES %}
          {% for code, name in LANGUAGES %}"{{ code }}"{% if not forloop.last %},{% endif %}{% endfor %}
        ],
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.8",
          "ratingCount": "1000"
        },
        "featureList": [
          "PDF to Word conversion",
          "Word to PDF conversion",
          "PDF merge",
          "PDF split",
          "PDF rotate",
          "Add watermark",
          "Crop PDF",
          "Compress PDF",
          "Protect PDF",
          "Organize PDF pages"
        ]
      }
    </script>

    {% block structured_data %}{% endblock %}
    {% block extra_head %}{% endblock %}

    {% if turnstile_site_key %}
      <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    {% endif %}

    <!-- Unified Analytics: Yandex.Metrika + GA4 with CookieConsent -->
    <script>
      (function() {
        // Yandex.Metrika loader
        (function(m,e,t,r,i,k,a){
          m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
          m[i].l=1*new Date();
          for (var j = 0; j < document.scripts.length; j++) {
            if (document.scripts[j].src === r) { return; }
          }
          k=e.createElement(t), a=e.getElementsByTagName(t)[0];
          k.async = 1;
          k.src = r;
          a.parentNode.insertBefore(k,a);
        })(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

        // Google Analytics 4 loader
        var gtagScript = document.createElement('script');
        gtagScript.src = "https://www.googletagmanager.com/gtag/js?id=G-65KKH2JRKC";
        gtagScript.async = true;
        document.head.appendChild(gtagScript);

        function initAnalytics() {
          // --- Yandex.Metrika ---
          if (window.ym) {
            ym(105790338, 'init', {
              clickmap: true,
              trackLinks: true,
              accurateTrackBounce: true,
              webvisor: false
            });
            ym(105790338, 'hit', window.location.href);
          }

          // --- Google Analytics 4 ---
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          window.gtag = gtag;
          gtag('js', new Date());
          gtag('config', 'G-65KKH2JRKC', { send_page_view: false });
          gtag('event', 'page_view', { page_path: window.location.pathname });
        }

        document.addEventListener('DOMContentLoaded', function () {
          if (window.CookieConsent) {
            if (window.CookieConsent.hasUserConsented()) {
              initAnalytics();
            } else {
              window.addEventListener('CookieConsentAccepted', initAnalytics);
            }
          } else {
            initAnalytics();
          }
        });
      })();
    </script>

  </head>
  <body class="bg-gray-50 text-gray-900 antialiased pt-24 sm:pt-24 md:pt-[72px]">
    <!-- Global JS Settings from Django -->
    <script>
      window.JS_SETTINGS = {
        patienceMessageDelay: {{ js_settings.patience_message_delay|default:40 }} * 1000,
        pollInterval: {{ js_settings.poll_interval|default:2500 }}
      };
    </script>

    {% include "frontend/includes/header.html" %}

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8 min-h-screen bg-gray-50 text-gray-900">
      {% block content %}{% endblock %}
    </main>

    {% include "frontend/includes/footer.html" %}
    {% include "frontend/includes/cookie_banner.html" %}

    <script src="{% static 'js/cookie-consent.js' %}" defer></script>
    <script src="{% static 'js/language-detection.js' %}" defer></script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
