{% load static i18n %}
<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
{% get_current_language_bidi as LANGUAGE_BIDI %}
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Primary Meta Tags -->
    <title>{% block title %}Convertica – Online PDF ↔ Word Converter{% endblock %}</title>
    <meta name="title" content="{% block meta_title %}{% endblock %}">
    <meta name="description" content="{% block description %}{% trans "Fast, simple and secure online PDF to Word and Word to PDF converter. No installations required." %}{% endblock %}">
    <meta name="keywords" content="{% block keywords %}{% trans "PDF to Word, Word to PDF, PDF converter, DOCX converter, online converter, free converter" %}{% endblock %}">
    <meta name="author" content="Convertica">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="language" content="{{ LANGUAGE_CODE }}">
    <meta name="revisit-after" content="7 days">
    <meta name="theme-color" content="#2563eb">
    <meta name="format-detection" content="telephone=no">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}">
    <meta property="og:title" content="{% block og_title %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'images/og-image.jpg' %}{% endblock %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{% block og_image_alt %}Convertica - Online PDF Tools{% endblock %}">
    <meta property="og:locale" content="{% if LANGUAGE_CODE == 'ru' %}ru_RU{% elif LANGUAGE_CODE == 'pl' %}pl_PL{% elif LANGUAGE_CODE == 'hi' %}hi_IN{% elif LANGUAGE_CODE == 'es' %}es_ES{% elif LANGUAGE_CODE == 'id' %}id_ID{% else %}en_US{% endif %}">
    <meta property="og:site_name" content="Convertica">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}">
    <meta property="twitter:title" content="{% block twitter_title %}{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'images/og-image.jpg' %}{% endblock %}">

    <!-- Canonical URL (with language prefix for proper SEO) -->
    <link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}">

    <!-- Preconnect to external domains for performance -->
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://challenges.cloudflare.com">
    <link rel="preconnect" href="https://challenges.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://cloudflare-static.com">
    <link rel="preconnect" href="https://cloudflare-static.com" crossorigin>
    <!-- Google Fonts for better typography -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>

    <!-- Hreflang Tags for SEO -->
    {% for link in hreflangs %}
      <link rel="alternate" hreflang="{{ link.code }}" href="{{ link.url }}">
    {% endfor %}

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon-16x16.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}">

    <!-- Stylesheets -->
    {% load static %}
    <!-- Preload critical CSS early to reduce render blocking -->
    <link rel="preload" href="{% static 'css/tailwind.css' %}" as="style">
    <link rel="stylesheet" href="{% static 'css/tailwind.css' %}" media="all">

    <!-- Custom Animations -->
    <style>
      @keyframes progress {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.8); }
        to { opacity: 1; transform: scale(1); }
      }

      @keyframes ping {
        75%, 100% { transform: scale(2); opacity: 0; }
      }

      .animate-progress {
        animation: progress 2s linear infinite;
        background-size: 200% 100%;
      }

      .animate-fade-in {
        animation: fadeIn 0.5s ease-out;
      }

      .animate-scale-in {
        animation: scaleIn 0.3s ease-out;
      }

      .shadow-3xl {
        box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.25);
      }

        /* Prevent horizontal scrolling on mobile */
      html, body {
        overflow-x: hidden;
        max-width: 100%;
        width: 100%;
      }

        /* Ensure all containers don't overflow */
      * {
        box-sizing: border-box;
      }

        /* Force dark text on light backgrounds by default */
      body {
        color: #111827; /* gray-900 */
      }

        /* Ensure all text elements inherit color properly */
      p, span, div, h1, h2, h3, h4, h5, h6, a, li, label, button, input, select, textarea {
        color: inherit;
      }

        /* Smooth transitions */
      * {
        transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 150ms;
      }

        /* Ensure images and media don't overflow */
      img, video, iframe, embed, object {
        max-width: 100%;
        height: auto;
      }

        /* Fix for dropdown menus on mobile */
      @media (max-width: 640px) {
        .absolute {
          max-width: calc(100vw - 1rem);
        }
      }
    </style>

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Convertica",
        "url": "{{ request.scheme }}://{{ request.get_host }}",
        "description": "{% trans "Fast, simple and secure online PDF to Word and Word to PDF converter." %}",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "inLanguage": "{{ LANGUAGE_CODE }}",
        "availableLanguage": [
          {% get_available_languages as LANGUAGES %}
          {% for code, name in LANGUAGES %}"{{ code }}"{% if not forloop.last %},{% endif %}{% endfor %}
        ],
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.8",
          "ratingCount": "1000"
        },
        "featureList": [
          "PDF to Word conversion",
          "Word to PDF conversion",
          "PDF merge",
          "PDF split",
          "PDF rotate",
          "Add watermark",
          "Crop PDF",
          "Compress PDF",
          "Protect PDF",
          "Organize PDF pages"
        ]
      }
    </script>

    {% block structured_data %}{% endblock %}

    {% block extra_head %}{% endblock %}

    <!-- Cloudflare Turnstile (Anti-spam) -->
    {% if turnstile_site_key %}
      <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    {% endif %}
  </head>
  <body class="bg-gray-50 text-gray-900 antialiased pt-24 sm:pt-24 md:pt-[72px]">

    {% include "frontend/includes/header.html" %}

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8 min-h-screen bg-gray-50 text-gray-900">
      {% block content %}{% endblock %}
    </main>

    {% include "frontend/includes/footer.html" %}

    {% include "frontend/includes/cookie_banner.html" %}

    <!-- Cookie Consent Utility -->
    <script src="{% static 'js/cookie-consent.js' %}" defer></script>

    <script src="{% static 'js/language-detection.js' %}" defer></script>

    <script>
    // Example: Initialize analytics only if allowed
      document.addEventListener('DOMContentLoaded', function() {
        // Check if user has consented
        if (window.CookieConsent && window.CookieConsent.hasUserConsented()) {
            // Initialize analytics if allowed
          window.CookieConsent.initAnalyticsIfAllowed(function() {
                // Your analytics initialization code here
                // Example: Google Analytics
                // if (typeof gtag !== 'undefined') {
                //     gtag('config', 'GA_MEASUREMENT_ID');
                // }
            console.log('Analytics initialized (if allowed)');
          });

            // Initialize marketing if allowed
          window.CookieConsent.initMarketingIfAllowed(function() {
                // Your marketing initialization code here
                // Example: Facebook Pixel, Google Ads, etc.
            console.log('Marketing initialized (if allowed)');
          });

            // Track page view
          window.CookieConsent.trackPageView(window.location.pathname);
        }
      });
    </script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
