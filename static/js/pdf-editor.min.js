document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("editorForm");if(!e)return;const n=document.getElementById("fileInput"),t=document.getElementById("fileInputDrop"),o=e.querySelector('button[type="submit"]');document.getElementById("editorResult");if(!document.getElementById("loadingContainer")){const n=document.createElement("div");n.id="loadingContainer",n.className="hidden mt-6",e.parentNode.insertBefore(n,e.nextSibling)}if(!document.getElementById("downloadContainer")){const n=document.createElement("div");n.id="downloadContainer",n.className="hidden mt-6",e.parentNode.insertBefore(n,e.nextSibling)}function i(){window.hideDownload("downloadContainer")}function d(){const e=document.getElementById("editorResult");e&&e.classList.add("hidden")}function l(n){o&&(o.disabled=n);e.querySelectorAll("input, select, textarea, button").forEach(e=>{e!==o&&(e.disabled=n)})}e.addEventListener("submit",async o=>{o.preventDefault();const r=document.getElementById("pdf_files_input"),a=document.getElementById("selectedPdfFilesList");if(r&&a)return;const c=new FormData,m=window.FILE_INPUT_NAME||"pdf_file",w=n?.files&&n.files.length>0?n.files:t?.files&&t.files.length>0?t.files:null,u=Boolean(window.BATCH_ENABLED&&window.IS_PREMIUM&&w&&w.length>1&&window.BATCH_API_URL&&window.BATCH_FIELD_NAME);let f=w?.[0]||null;if(!f)return void showError(window.SELECT_FILE_MESSAGE||"Please select a file");if(u){const e=window.BATCH_FIELD_NAME;Array.from(w).forEach(n=>{c.append(e,n)})}else c.append(m,f);d(),i(),window.showLoading("loadingContainer",{showProgress:!u}),l(!0),window._onCancelCallback=()=>{window.hideLoading("loadingContainer"),l(!1)};const p=new AbortController;window._currentAbortController=p;e.querySelectorAll("input, select, textarea").forEach(e=>{if("file"!==e.type&&"csrfmiddlewaretoken"!==e.name&&("watermark_file"!==e.name||!document.getElementById("watermarkTypeText")?.checked)&&("watermark_text"!==e.name||!document.getElementById("watermarkTypeImage")?.checked)&&e.value&&""!==e.value.trim())if("number"===e.type){const n=parseFloat(e.value);isNaN(n)||c.append(e.name,n)}else c.append(e.name,e.value)});try{const e=u?window.BATCH_API_URL:window.API_URL,n=await fetch(e,{method:"POST",headers:{"X-CSRFToken":window.CSRF_TOKEN},body:c,signal:p.signal}),t=await n.blob();if(!n.ok)try{const e=await t.text(),n=JSON.parse(e);throw new Error(n.error||window.ERROR_MESSAGE)}catch{throw new Error(window.ERROR_MESSAGE||"Editing failed")}window.hideLoading("loadingContainer");const o=n.headers.get("X-Input-Size"),r=n.headers.get("X-Output-Size"),a=n.headers.get("X-Compression-Ratio");o&&r&&a&&function(e,n,t){let o=document.getElementById("compressionNotification");if(!o){o=document.createElement("div"),o.id="compressionNotification",o.className="mt-4";const e=document.getElementById("editorForm");e&&e.parentNode&&e.parentNode.insertBefore(o,e.nextSibling)}const i=s(e),d=s(n),l=e-n,r=s(l);let a="from-blue-50 to-blue-100",c="border-blue-300",m="text-blue-900",w="text-blue-600";t>30?(a="from-green-50 to-green-100",c="border-green-300",m="text-green-900",w="text-green-600"):t>10&&(a="from-yellow-50 to-yellow-100",c="border-yellow-300",m="text-yellow-900",w="text-yellow-600");o.innerHTML=`\n            <div class="bg-gradient-to-br ${a} border-2 ${c} rounded-xl p-5 sm:p-6 animate-fade-in">\n                <div class="flex items-start space-x-4">\n                    <div class="flex-shrink-0">\n                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm">\n                            <svg class="w-6 h-6 ${w}" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="flex-1 min-w-0">\n                        <h4 class="text-lg font-bold ${m} mb-2">\n                            ${t>0?"âœ“ File Compressed Successfully!":"File Processed"}\n                        </h4>\n                        <div class="space-y-2 text-sm ${m}">\n                            <div class="flex items-center justify-between">\n                                <span class="font-medium">Original Size:</span>\n                                <span class="font-mono">${i}</span>\n                            </div>\n                            <div class="flex items-center justify-between">\n                                <span class="font-medium">Compressed Size:</span>\n                                <span class="font-mono font-bold">${d}</span>\n                            </div>\n                            <div class="flex items-center justify-between pt-2 border-t ${c}">\n                                <span class="font-bold">Size Reduction:</span>\n                                <span class="font-mono font-bold">${t.toFixed(1)}% (${r})</span>\n                            </div>\n                        </div>\n                    </div>\n                    <button onclick="this.parentElement.parentElement.remove()"\n                            class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n        `,o.classList.remove("hidden"),setTimeout(()=>{o&&o.parentNode&&o.classList.add("hidden")},1e4)}(parseInt(o),parseInt(r),parseFloat(a));const m=n.headers.get("content-disposition");let w=u?"convertica.zip":f.name;if(m){const e=m.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(w=e[1].replace(/['"]/g,""))}window.showDownloadButton(t,w,"downloadContainer",{successTitle:window.SUCCESS_TITLE||"Editing Complete!",downloadButtonText:window.DOWNLOAD_BUTTON_TEXT||"Download File",convertAnotherText:window.EDIT_ANOTHER_TEXT||"Edit another file",onConvertAnother:()=>{const e=document.getElementById("fileInput"),n=document.getElementById("fileInputDrop"),t=document.getElementById("selectedFile"),o=document.getElementById("fileInfo"),s=document.getElementById("editButton");e&&(e.value=""),n&&(n.value=""),t&&t.classList.add("hidden"),o&&o.classList.remove("hidden"),s&&(s.disabled=!0),i(),d(),l(!1),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{const e=document.getElementById("selectFileButton");e&&e.focus({preventScroll:!0})},800)}}),l(!1)}catch(e){if(e&&"AbortError"===e.name)return;window.hideLoading("loadingContainer"),window.showError(e.message||window.ERROR_MESSAGE,"editorResult"),l(!1)}});const s=window.formatFileSize||function(e){if(0===e)return"0 Bytes";const n=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,n)*100)/100+" "+["Bytes","KB","MB","GB"][n]}});