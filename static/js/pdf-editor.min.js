document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("editorForm");if(!e)return;const t=document.getElementById("fileInput"),n=document.getElementById("fileInputDrop"),o=e.querySelector('button[type="submit"]');document.getElementById("editorResult");if(!document.getElementById("loadingContainer")){const t=document.createElement("div");t.id="loadingContainer",t.className="hidden mt-6",e.parentNode.insertBefore(t,e.nextSibling)}if(!document.getElementById("downloadContainer")){const t=document.createElement("div");t.id="downloadContainer",t.className="hidden mt-6",e.parentNode.insertBefore(t,e.nextSibling)}function i(){window.hideDownload("downloadContainer")}function d(){const e=document.getElementById("editorResult");e&&e.classList.add("hidden")}function s(t){o&&(o.disabled=t);e.querySelectorAll("input, select, textarea, button").forEach(e=>{e!==o&&(e.disabled=t)})}e.addEventListener("submit",async o=>{o.preventDefault();const a=document.getElementById("pdf_files_input"),r=document.getElementById("selectedPdfFilesList");if(a&&r)return;const c=new FormData,m=window.FILE_INPUT_NAME||"pdf_file",u=t?.files&&t.files.length>0?t.files:n?.files&&n.files.length>0?n.files:null,w=Boolean(window.BATCH_ENABLED&&window.IS_PREMIUM&&u&&u.length>1&&window.BATCH_API_URL&&window.BATCH_FIELD_NAME);let f=u?.[0]||null;if(!f)return void showError(window.SELECT_FILE_MESSAGE||"Please select a file");if(w){const e=window.BATCH_FIELD_NAME;Array.from(u).forEach(t=>{c.append(e,t)})}else c.append(m,f);d(),i(),window.showLoading("loadingContainer",{showProgress:!w}),s(!0);e.querySelectorAll("input, select, textarea").forEach(e=>{if("file"!==e.type&&"csrfmiddlewaretoken"!==e.name&&("watermark_file"!==e.name||!document.getElementById("watermarkTypeText")?.checked)&&("watermark_text"!==e.name||!document.getElementById("watermarkTypeImage")?.checked)&&e.value&&""!==e.value.trim())if("number"===e.type){const t=parseFloat(e.value);isNaN(t)||c.append(e.name,t)}else c.append(e.name,e.value)});try{const e=w?window.BATCH_API_URL:window.API_URL,t=await fetch(e,{method:"POST",headers:{"X-CSRFToken":window.CSRF_TOKEN},body:c}),n=await t.blob();if(!t.ok)try{const e=await n.text(),t=JSON.parse(e);throw new Error(t.error||window.ERROR_MESSAGE)}catch{throw new Error(window.ERROR_MESSAGE||"Editing failed")}window.hideLoading("loadingContainer");const o=t.headers.get("X-Input-Size"),a=t.headers.get("X-Output-Size"),r=t.headers.get("X-Compression-Ratio");o&&a&&r&&function(e,t,n){let o=document.getElementById("compressionNotification");if(!o){o=document.createElement("div"),o.id="compressionNotification",o.className="mt-4";const e=document.getElementById("editorForm");e&&e.parentNode&&e.parentNode.insertBefore(o,e.nextSibling)}const i=l(e),d=l(t),s=e-t,a=l(s);let r="from-blue-50 to-blue-100",c="border-blue-300",m="text-blue-900",u="text-blue-600";n>30?(r="from-green-50 to-green-100",c="border-green-300",m="text-green-900",u="text-green-600"):n>10&&(r="from-yellow-50 to-yellow-100",c="border-yellow-300",m="text-yellow-900",u="text-yellow-600");o.innerHTML=`\n            <div class="bg-gradient-to-br ${r} border-2 ${c} rounded-xl p-5 sm:p-6 animate-fade-in">\n                <div class="flex items-start space-x-4">\n                    <div class="flex-shrink-0">\n                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm">\n                            <svg class="w-6 h-6 ${u}" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="flex-1 min-w-0">\n                        <h4 class="text-lg font-bold ${m} mb-2">\n                            ${n>0?"âœ“ File Compressed Successfully!":"File Processed"}\n                        </h4>\n                        <div class="space-y-2 text-sm ${m}">\n                            <div class="flex items-center justify-between">\n                                <span class="font-medium">Original Size:</span>\n                                <span class="font-mono">${i}</span>\n                            </div>\n                            <div class="flex items-center justify-between">\n                                <span class="font-medium">Compressed Size:</span>\n                                <span class="font-mono font-bold">${d}</span>\n                            </div>\n                            <div class="flex items-center justify-between pt-2 border-t ${c}">\n                                <span class="font-bold">Size Reduction:</span>\n                                <span class="font-mono font-bold">${n.toFixed(1)}% (${a})</span>\n                            </div>\n                        </div>\n                    </div>\n                    <button onclick="this.parentElement.parentElement.remove()"\n                            class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n        `,o.classList.remove("hidden"),setTimeout(()=>{o&&o.parentNode&&o.classList.add("hidden")},1e4)}(parseInt(o),parseInt(a),parseFloat(r));const m=t.headers.get("content-disposition");let u=w?"convertica.zip":f.name;if(m){const e=m.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(u=e[1].replace(/['"]/g,""))}window.showDownloadButton(n,u,"downloadContainer",{successTitle:window.SUCCESS_TITLE||"Editing Complete!",downloadButtonText:window.DOWNLOAD_BUTTON_TEXT||"Download File",convertAnotherText:window.EDIT_ANOTHER_TEXT||"Edit another file",onConvertAnother:()=>{const e=document.getElementById("fileInput"),t=document.getElementById("fileInputDrop"),n=document.getElementById("selectedFile"),o=document.getElementById("fileInfo"),l=document.getElementById("editButton");e&&(e.value=""),t&&(t.value=""),n&&n.classList.add("hidden"),o&&o.classList.remove("hidden"),l&&(l.disabled=!0),i(),d(),s(!1),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{const e=document.getElementById("selectFileButton");e&&e.focus({preventScroll:!0})},800)}}),s(!1)}catch(e){window.hideLoading("loadingContainer"),window.showError(e.message||window.ERROR_MESSAGE,"editorResult"),s(!1)}});const l=window.formatFileSize||function(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}});