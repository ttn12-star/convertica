class PWAInstaller{constructor(){this.deferredPrompt=null,this.installButton=null,this.isInstalled=!1,this.dismissed=!1,this.isLinuxDesktop=!1,this.init()}init(){try{const t=Number(localStorage.getItem("pwa-install-dismissed")||0);t&&Date.now()<t&&(this.dismissed=!0)}catch(t){}if(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone)return this.isInstalled=!0,void console.log("[PWA] App is already installed");window.addEventListener("beforeinstallprompt",t=>{console.log("[PWA] Install prompt available");try{const t=navigator.userAgent||"",e=navigator.platform||"",n=/Android/i.test(t),i=/iPhone|iPad|iPod/i.test(t),o=/Linux/i.test(e)||/Linux/i.test(t);this.isLinuxDesktop=Boolean(o&&!n);if(!Boolean(n||i))return}catch(t){this.isLinuxDesktop=!1}this.isLinuxDesktop||(t.preventDefault(),this.deferredPrompt=t,this.dismissed||this.showInstallButton())}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App installed successfully"),this.isInstalled=!0,this.hideInstallButton(),"undefined"!=typeof gtag&&gtag("event","pwa_install",{event_category:"engagement",event_label:"PWA Installed"})}),"serviceWorker"in navigator&&this.registerServiceWorker()}async registerServiceWorker(){try{const t=await navigator.serviceWorker.register("/sw.js",{scope:"/"});console.log("[PWA] Service Worker registered:",t.scope),t.addEventListener("updatefound",()=>{const e=t.installing;console.log("[PWA] Service Worker update found"),e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&this.showUpdateNotification()})})}catch(t){console.error("[PWA] Service Worker registration failed:",t)}}showInstallButton(){if(document.getElementById("pwa-install-button"))return;const t=document.createElement("div");t.id="pwa-install-banner",t.className="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg shadow-2xl p-4 z-50 transform transition-all duration-300 ease-in-out",t.innerHTML='\n            <div class="flex items-start gap-3">\n                <div class="flex-shrink-0">\n                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>\n                    </svg>\n                </div>\n                <div class="flex-1 min-w-0">\n                    <h3 class="text-sm font-semibold mb-1">Install Convertica</h3>\n                    <p class="text-xs opacity-90 mb-3">Add to your home screen for quick access and offline support!</p>\n                    <div class="flex gap-2">\n                        <button id="pwa-install-button" class="px-4 py-2 bg-white text-blue-600 rounded-md text-sm font-medium hover:bg-gray-100 transition-colors">\n                            Install\n                        </button>\n                        <button id="pwa-install-dismiss" class="px-4 py-2 bg-transparent border border-white/30 rounded-md text-sm font-medium hover:bg-white/10 transition-colors">\n                            Not now\n                        </button>\n                    </div>\n                </div>\n                <button id="pwa-install-close" class="flex-shrink-0 text-white/70 hover:text-white transition-colors">\n                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>\n                    </svg>\n                </button>\n            </div>\n        ',document.body.appendChild(t),document.getElementById("pwa-install-button").addEventListener("click",()=>{this.promptInstall()}),document.getElementById("pwa-install-dismiss").addEventListener("click",()=>{this.hideInstallButton(),localStorage.setItem("pwa-install-dismissed",Date.now()+6048e5)}),document.getElementById("pwa-install-close").addEventListener("click",()=>{this.hideInstallButton()}),setTimeout(()=>{t.style.transform="translateY(0)"},100)}hideInstallButton(){const t=document.getElementById("pwa-install-banner");t&&(t.style.transform="translateY(150%)",setTimeout(()=>{t.remove()},300))}async promptInstall(){if(!this.deferredPrompt)return void console.log("[PWA] Install prompt not available");this.deferredPrompt.prompt();const{outcome:t}=await this.deferredPrompt.userChoice;console.log("[PWA] User choice:",t),"accepted"===t?(console.log("[PWA] User accepted the install prompt"),"undefined"!=typeof gtag&&gtag("event","pwa_install_accepted",{event_category:"engagement"})):(console.log("[PWA] User dismissed the install prompt"),"undefined"!=typeof gtag&&gtag("event","pwa_install_dismissed",{event_category:"engagement"})),this.deferredPrompt=null,this.hideInstallButton()}showUpdateNotification(){const t=document.createElement("div");t.id="pwa-update-banner",t.className="fixed top-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md bg-green-600 text-white rounded-lg shadow-2xl p-4 z-50",t.innerHTML='\n            <div class="flex items-start gap-3">\n                <div class="flex-shrink-0">\n                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>\n                    </svg>\n                </div>\n                <div class="flex-1">\n                    <h3 class="text-sm font-semibold mb-1">Update Available</h3>\n                    <p class="text-xs opacity-90 mb-2">A new version of Convertica is available!</p>\n                    <button id="pwa-update-button" class="px-4 py-1.5 bg-white text-green-600 rounded-md text-sm font-medium hover:bg-gray-100 transition-colors">\n                        Reload to Update\n                    </button>\n                </div>\n            </div>\n        ',document.body.appendChild(t),document.getElementById("pwa-update-button").addEventListener("click",()=>{window.location.reload()})}async requestNotificationPermission(){if(!("Notification"in window))return console.log("[PWA] Notifications not supported"),!1;if("granted"===Notification.permission)return!0;if("denied"!==Notification.permission){return"granted"===await Notification.requestPermission()}return!1}async showNotification(t,e={}){if(!await this.requestNotificationPermission())return void console.log("[PWA] Notification permission denied");const n=await navigator.serviceWorker.ready;await n.showNotification(t,{body:e.body||"Your conversion is complete!",icon:e.icon||"/static/favicon-192x192.png",badge:e.badge||"/static/favicon-96x96.png",tag:e.tag||"convertica-notification",requireInteraction:e.requireInteraction||!1,data:e.data||{},...e})}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.pwaInstaller=new PWAInstaller}):window.pwaInstaller=new PWAInstaller,"undefined"!=typeof window&&(window.PWAInstaller=PWAInstaller);