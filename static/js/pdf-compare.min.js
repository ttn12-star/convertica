document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("compareForm");if(!e)return;const n=document.getElementById("compareButton"),o=document.getElementById("diffThreshold"),t=document.getElementById("diffThresholdValue");function d(e){n&&(n.disabled=e,n.classList.toggle("opacity-50",e),n.classList.toggle("cursor-not-allowed",e));const t=document.getElementById("pdfFile1"),d=document.getElementById("pdfFile2");t&&(t.disabled=e),d&&(d.disabled=e),o&&(o.disabled=e)}o&&t&&o.addEventListener("input",()=>{t.textContent=o.value}),e.addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("pdfFile1"),t=document.getElementById("pdfFile2"),i=n?.files?.[0],a=t?.files?.[0];if(!i||!a)return void window.showError(window.COMPARE_FILE_MESSAGE||"Please select two PDF files.","converterResult");const r=new FormData;r.append("pdf_file_1",i),r.append("pdf_file_2",a),r.append("diff_threshold",o?.value||"32"),window.hideError("converterResult"),window.hideDownload("downloadContainer"),window.showLoading("loadingContainer",{showProgress:!0}),d(!0);try{const e=await fetch(window.COMPARE_API_URL,{method:"POST",headers:{"X-CSRFToken":window.CSRF_TOKEN||""},body:r});if(!e.ok){let n=window.COMPARE_ERROR_MESSAGE||"Comparison failed.";try{n=(await e.json()).error||n}catch(e){}throw new Error(n)}const n=await e.blob(),o=function(e,n){const o=(e.headers.get("content-disposition")||"").match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);return o&&o[1]?o[1].replace(/['"]/g,""):n}(e,`${i.name.replace(/\.pdf$/i,"")}_vs_${a.name.replace(/\.pdf$/i,"")}_convertica.zip`);window.hideLoading("loadingContainer",!0),window.showDownloadButton(n,o,"downloadContainer")}catch(e){window.hideLoading("loadingContainer"),window.showError(e.message||window.COMPARE_ERROR_MESSAGE||"Comparison failed.","converterResult")}finally{d(!1)}})});