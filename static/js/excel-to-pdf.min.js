class ExcelToPDFConverter{constructor(){this.form=document.getElementById("excelToPdfForm"),this.dropZone=document.getElementById("dropZone"),this.fileInput=document.getElementById("excelFile"),this.browseBtn=document.getElementById("browseBtn"),this.fileInfo=document.getElementById("fileInfo"),this.fileName=document.getElementById("fileName"),this.fileSize=document.getElementById("fileSize"),this.removeFileBtn=document.getElementById("removeFile"),this.batchSection=document.getElementById("batchSection"),this.enableBatchBtn=document.getElementById("enableBatch"),this.convertBtn=document.getElementById("convertBtn"),this.progressSection=document.getElementById("progressSection"),this.progressBar=document.getElementById("progressBar"),this.progressPercent=document.getElementById("progressPercent"),this.progressMessage=document.getElementById("progressMessage"),this.resultSection=document.getElementById("resultSection"),this.downloadLink=document.getElementById("downloadLink"),this.convertAnotherBtn=document.getElementById("convertAnother"),this.currentFile=null,this.isBatchMode=!1,this.isPremium=!1,this.init()}init(){this.checkPremiumStatus(),this.browseBtn.addEventListener("click",()=>this.fileInput.click()),this.fileInput.addEventListener("change",e=>this.handleFileSelect(e.target.files[0])),this.dropZone.addEventListener("dragover",e=>{e.preventDefault(),this.dropZone.classList.add("border-blue-500","bg-blue-50")}),this.dropZone.addEventListener("dragleave",e=>{e.preventDefault(),this.dropZone.classList.remove("border-blue-500","bg-blue-50")}),this.dropZone.addEventListener("drop",e=>{e.preventDefault(),this.dropZone.classList.remove("border-blue-500","bg-blue-50");const t=e.dataTransfer.files;t.length>0&&this.handleFileSelect(t[0])}),this.removeFileBtn.addEventListener("click",()=>this.removeFile()),this.enableBatchBtn.addEventListener("click",()=>this.enableBatchMode()),this.form.addEventListener("submit",e=>this.handleSubmit(e)),this.convertAnotherBtn.addEventListener("click",()=>this.resetForm())}checkPremiumStatus(){fetch("/api/user-info/").then(e=>e.json()).then(e=>{this.isPremium=e.is_premium||!1,this.isPremium&&(this.batchSection.classList.remove("hidden"),this.enableBatchMode())}).catch(e=>{console.log("Could not check premium status:",e)})}handleFileSelect(e){if(!e)return;const t=e.name.toLowerCase().substring(e.name.lastIndexOf("."));if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/octet-stream"].includes(e.type)&&![".xls",".xlsx"].includes(t))return void this.showError("Please select a valid Excel file (.xls or .xlsx)");const s=this.isPremium?209715200:52428800;if(e.size>s){const e=s/1048576;return void this.showError(`File size exceeds ${e}MB limit`)}this.currentFile=e,this.displayFileInfo(),this.convertBtn.disabled=!1,this.dropZone.classList.add("hidden"),this.fileInfo.classList.remove("hidden")}displayFileInfo(){this.fileName.textContent=this.currentFile.name,this.fileSize.textContent=window.formatFileSize?window.formatFileSize(this.currentFile.size):`${(this.currentFile.size/1024/1024).toFixed(2)} MB`}removeFile(){this.currentFile=null,this.fileInput.value="",this.convertBtn.disabled=!0,this.dropZone.classList.remove("hidden"),this.fileInfo.classList.add("hidden"),this.resetProgress()}enableBatchMode(){this.isBatchMode=!0,this.enableBatchBtn.textContent="Batch Mode Enabled ✓",this.enableBatchBtn.disabled=!0,this.enableBatchBtn.classList.add("bg-purple-700"),this.fileInput.multiple=!0,this.fileInput.accept=".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";const e=this.dropZone.querySelector("p.text-lg");e&&(e.innerHTML="<strong>Select multiple Excel files</strong> (up to 10 files)");const t=this.dropZone.querySelector("p.text-sm");if(t&&(t.textContent="Drag & drop or click to browse • .xls and .xlsx files up to 200MB each"),this.browseBtn){const e=this.browseBtn.querySelector("span");e&&(e.textContent="Select Excel files (multiple)")}}async handleSubmit(e){if(e.preventDefault(),!this.currentFile)return void this.showError("Please select a file to convert");this.showProgress();const t=new FormData;if(this.isBatchMode){const e=Array.from(this.fileInput.files);if(e.length>10)return void this.showError("Maximum 10 files allowed for batch processing");e.forEach((e,s)=>{t.append(`excel_files[${s}]`,e)}),this.updateProgress(10,"Preparing batch conversion...");try{const e=await fetch("/api/excel-to-pdf/batch/",{method:"POST",body:t,headers:{"X-CSRFToken":this.form.querySelector("[name=csrfmiddlewaretoken]").value}}),s=await e.json();if(!e.ok)throw new Error(s.error||"Batch conversion failed");this.updateProgress(100,"Batch conversion completed!"),this.showBatchResult(s)}catch(e){this.showError(e.message),this.hideProgress()}}else{t.append("excel_file",this.currentFile),this.updateProgress(10,"Converting Excel to PDF...");try{const e=await fetch("/api/excel-to-pdf/",{method:"POST",body:t,headers:{"X-CSRFToken":this.form.querySelector("[name=csrfmiddlewaretoken]").value}}),s=await e.json();if(!e.ok)throw new Error(s.error||"Conversion failed");this.updateProgress(100,"Conversion completed!"),this.showResult(s)}catch(e){this.showError(e.message),this.hideProgress()}}}showProgress(){this.progressSection.classList.remove("hidden"),this.resultSection.classList.add("hidden"),this.convertBtn.disabled=!0,this.updateProgress(0,"Starting conversion...")}updateProgress(e,t){this.progressBar.style.width=`${e}%`,this.progressPercent.textContent=`${e}%`,this.progressMessage.textContent=t}hideProgress(){this.progressSection.classList.add("hidden"),this.convertBtn.disabled=!1}showResult(e){this.hideProgress(),this.resultSection.classList.remove("hidden"),e.download_url&&(this.downloadLink.href=e.download_url,this.downloadLink.download=this.currentFile.name.replace(/\.(xls|xlsx)$/i,".pdf"))}showBatchResult(e){this.hideProgress(),this.resultSection.classList.remove("hidden");const t=this.resultSection.querySelector(".mt-4");t.innerHTML="",e.results&&Array.isArray(e.results)&&e.results.forEach((e,s)=>{const n=document.createElement("a");n.href=e.download_url,n.className="block w-full px-4 py-2 bg-green-600 text-white text-center rounded-lg hover:bg-green-700 transition-colors mb-2",n.download=e.filename||`converted_${s+1}.pdf`,n.textContent=`Download ${e.filename||`File ${s+1}`}`,t.appendChild(n)});const s=document.createElement("button");s.type="button",s.className="w-full px-4 py-2 border border-green-600 text-green-600 rounded-lg hover:bg-green-50 transition-colors",s.textContent="Convert More Files",s.addEventListener("click",()=>this.resetForm()),t.appendChild(s)}showError(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-50 border border-red-200 rounded-lg p-4 shadow-lg z-50",t.innerHTML=`\n            <div class="flex items-center space-x-3">\n                <svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n                </svg>\n                <div>\n                    <h3 class="text-sm font-medium text-red-900">Error</h3>\n                    <p class="text-sm text-red-700">${e}</p>\n                </div>\n                <button type="button" class="text-red-500 hover:text-red-700" onclick="this.parentElement.parentElement.remove()">\n                    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\n                    </svg>\n                </button>\n            </div>\n        `,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},5e3)}resetProgress(){this.progressBar.style.width="0%",this.progressPercent.textContent="0%",this.progressMessage.textContent="Please wait while we convert your Excel file to PDF..."}resetForm(){if(this.removeFile(),this.hideProgress(),this.resultSection.classList.add("hidden"),this.resetProgress(),this.isBatchMode){this.isBatchMode=!1,this.fileInput.multiple=!1,this.enableBatchBtn.textContent="Enable Batch Processing",this.enableBatchBtn.disabled=!1,this.enableBatchBtn.classList.remove("bg-purple-700");this.dropZone.querySelector("p.text-lg").textContent="Drop your Excel file here or click to browse";this.dropZone.querySelector("p.text-sm").textContent="Support for .xls and .xlsx files up to 50MB"}}}document.addEventListener("DOMContentLoaded",()=>{new ExcelToPDFConverter});