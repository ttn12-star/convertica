document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("converterForm");if(!e)return;window.onTurnstileSuccess=function(n){let o=e.querySelector('[name="turnstile_token"]');o||(o=document.createElement("input"),o.type="hidden",o.name="turnstile_token",e.appendChild(o)),o.value=n};const n=e.querySelector('button[type="submit"]'),o=document.getElementById("converterResult"),t=document.createElement("div");t.id="loadingContainer",t.className="hidden mt-6";const d=document.createElement("div");function i(){window.hideDownload("downloadContainer")}function r(){o&&o.classList.add("hidden")}function a(e){n&&(n.disabled=e,e?n.classList.add("opacity-50","cursor-not-allowed"):n.classList.remove("opacity-50","cursor-not-allowed"));const o=document.getElementById("fileInput"),t=document.getElementById("fileInputDrop");o&&(o.disabled=e),t&&(t.disabled=e)}d.id="downloadContainer",d.className="hidden mt-6",e.addEventListener("submit",async o=>{o.preventDefault();const l=document.getElementById("fileInput"),s=document.getElementById("fileInputDrop"),c=l?.files&&l.files.length>0?l.files:s?.files&&s.files.length>0?s.files:null,u=c?.[0],p=Boolean(window.BATCH_ENABLED&&window.IS_PREMIUM&&c&&c.length>1&&window.BATCH_API_URL&&window.BATCH_FIELD_NAME);if(!u)return void window.showError(window.SELECT_FILE_MESSAGE||"Please select a file","converterResult");if(!p&&"application/pdf"===u.type)try{if(!await window.validatePdfPageLimit(u))return window.hideLoading("loadingContainer"),void a(!1)}catch(e){console.error("PDF validation error:",e)}r(),i(),!t.parentNode&&e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling),!d.parentNode&&e.parentNode&&e.parentNode.insertBefore(d,t.nextSibling||e.nextSibling),window.showLoading("loadingContainer",{showProgress:!p}),a(!0);const w=new FormData,f=window.FILE_INPUT_NAME||"file";if(p){const e=window.BATCH_FIELD_NAME;Array.from(c).forEach(n=>{w.append(e,n)})}else w.append(f,u);const m=e.querySelector('input[name="pages"]');m&&m.value&&w.append("pages",m.value);const g=e.querySelector('select[name="dpi"]');g&&g.value&&w.append("dpi",g.value);const _=e.querySelector('input[name="ocr_enabled"]');_&&w.append("ocr_enabled",_.checked?"true":"false");const h=e.querySelector('select[name="ocr_language"]');h?(w.append("ocr_language",h.value),console.log("OCR Debug: Sending language:",h.value)):console.log("OCR Debug: ocr_language select not found");const v=document.querySelector('[name="cf-turnstile-response"]');v&&v.value&&w.append("turnstile_token",v.value);let E=window.CONVERSION_TYPE||"";if(!E){const e=window.API_URL||"";e.includes("pdf-to-word")?E="pdf_to_word":e.includes("word-to-pdf")?E="word_to_pdf":e.includes("pdf-to-excel")?E="pdf_to_excel":e.includes("pdf-to-jpg")?E="pdf_to_jpg":e.includes("jpg-to-pdf")?E="jpg_to_pdf":e.includes("epub-to-pdf")?E="epub_to_pdf":e.includes("pdf-to-epub")?E="pdf_to_epub":e.includes("compress")&&(E="compress_pdf")}const y=["pdf_to_word","word_to_pdf","pdf_to_excel","epub_to_pdf","pdf_to_epub"].includes(E),C=["pdf_to_jpg","compress_pdf"].includes(E),I=u.size>5242880,B=!p&&(y||C&&I||u.size>10485760);let L=p?window.BATCH_API_URL:window.API_URL;(y||C)&&B&&!L.endsWith("/async/")&&(L=L.replace(/\/$/,"")+"/async/"),window._onCancelCallback=()=>{window.hideLoading("loadingContainer"),a(!1)};try{await window.submitAsyncConversion({apiUrl:L,formData:w,csrfToken:window.CSRF_TOKEN||"",originalFileName:p?"convertica.zip":u.name,loadingContainerId:"loadingContainer",downloadContainerId:"downloadContainer",errorContainerId:"converterResult",useAsync:B,onBackground:()=>{a(!1)},onSuccess:(e,o,t)=>{if(p&&t&&t.headers){const e=parseInt(t.headers.get("X-Convertica-Batch-Failed-Count")||"0"),n=parseInt(t.headers.get("X-Convertica-Batch-Count")||"0");if(e>0){const o=n+e,t=1===e?`Warning: 1 file out of ${o} failed to convert and was excluded from the archive. Check the file for corruption or try re-saving it.`:`Warning: ${e} files out of ${o} failed to convert and were excluded from the archive. Check these files for corruption or try re-saving them.`;window.showError(t,"converterResult")}}window.showDownloadButton(e,o,"downloadContainer",{onConvertAnother:()=>{!function(){const e=document.getElementById("fileInput"),o=document.getElementById("fileInputDrop"),t=document.getElementById("selectedFile"),d=document.getElementById("fileInfo");e&&(e.value="");o&&(o.value="");t&&t.classList.add("hidden");d&&d.classList.remove("hidden");n&&(n.disabled=!0,n.classList.add("opacity-50","cursor-not-allowed"))}(),i(),r(),a(!1),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{const e=document.getElementById("selectFileButton");e&&e.focus({preventScroll:!0})},800)}})},onError:e=>{a(!1)},onProgress:(e,n)=>{}})}catch(e){"undefined"!=typeof console&&console.error&&console.error("Conversion error:",e),window.hideLoading("loadingContainer"),window.showError(e.message||window.ERROR_MESSAGE,"converterResult")}finally{a(!1)}})});